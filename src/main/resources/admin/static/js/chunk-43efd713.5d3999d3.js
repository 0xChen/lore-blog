(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43efd713"],{"137f":function(t,e,a){"use strict";var n=a("23bd"),i=a.n(n);i.a},"23bd":function(t,e,a){t.exports={primaryColor:"#3298dc",menuTextColor:"rgba(255,255,255,.65)",menuActiveTextColor:"#3298dc",menuBackgroundColor:"#324157",sidebarWidth:"210px",sidebarCollapsedWidth:"64px",headerHeight:"64px"}},a15b:function(t,e,a){"use strict";var n=a("23e7"),i=a("44ad"),o=a("fc6a"),c=a("a640"),r=[].join,s=i!=Object,l=c("join",",");n({target:"Array",proto:!0,forced:s||!l},{join:function(t){return r.call(o(this),void 0===t?",":t)}})},fa5b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"attachment"},[a("div",{staticClass:"attachment-search-form"},[a("el-row",{attrs:{gutter:4}},[a("el-col",{attrs:{md:4,sm:12}},[a("el-input",{attrs:{placeholder:"文件名",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.queryParam.name,callback:function(e){t.$set(t.queryParam,"name",e)},expression:"queryParam.name"}})],1),a("el-col",{attrs:{md:4,sm:12}},[a("el-input",{attrs:{placeholder:"原始文件名",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.queryParam.originalName,callback:function(e){t.$set(t.queryParam,"originalName",e)},expression:"queryParam.originalName"}})],1),a("el-col",{attrs:{md:3,sm:8}},[a("el-input",{attrs:{placeholder:"类型",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.queryParam.type,callback:function(e){t.$set(t.queryParam,"type",e)},expression:"queryParam.type"}})],1),a("el-col",{attrs:{md:8,sm:12}},[a("el-input",{attrs:{placeholder:"描述",size:"small",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter(e)}},model:{value:t.queryParam.description,callback:function(e){t.$set(t.queryParam,"description",e)},expression:"queryParam.description"}})],1),a("el-col",{attrs:{md:2,sm:4}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"small"},on:{click:t.getAttachmentPage}},[t._v(" 搜索 ")])],1),a("el-col",{attrs:{md:3,sm:4}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-upload2",size:"small"},on:{click:function(e){t.drawer=!0}}},[t._v(" 上传新附件 ")])],1)],1)],1),a("div",{staticClass:"attachment-list"},[a("div",{staticClass:"attachment-list--picture-card"},t._l(t.attachmentList,(function(e,n){return a("div",{key:e.id,staticClass:"attachment-list__item",attrs:{title:e.originalName}},[a("div",{staticStyle:{width:"100%",height:"100%"}},[a("el-image",{ref:"image-"+n,refInFor:!0,staticClass:"attachment-list__item-thumbnail",attrs:{src:t.imgSrcBaseUrl+"/"+e.name,alt:e.originalName,fit:"scale-down","preview-src-list":t.attachmentPreviewList}}),a("span",{staticClass:"attachment-list__item-actions"},[a("span",{staticClass:"attachment-list__item-operator",on:{click:function(a){return t.handleCopyUrl(e.name)}}},[a("el-tooltip",{attrs:{content:"复制文件链接",placement:"top"}},[a("svg-icon",{attrs:{name:"CopyOutlined"}})],1)],1),a("span",{staticClass:"attachment-list__item-operator",on:{click:function(e){return t.handlePreviewList(n)}}},[a("el-tooltip",{attrs:{content:"查看大图",placement:"top"}},[a("svg-icon",{attrs:{name:"ZoomInOutlined"}})],1)],1),a("span",{staticClass:"attachment-list__item-operator",on:{click:function(a){return t.handleDownload(e.name)}}},[a("el-tooltip",{attrs:{content:"下载",placement:"top"}},[a("svg-icon",{attrs:{name:"CloudDownloadOutlined"}})],1)],1),a("span",{staticClass:"attachment-list__item-operator"},[a("el-tooltip",{attrs:{content:"删除",placement:"top"}},[a("el-popconfirm",{attrs:{hideIcon:"",placement:"top",title:"确定删除？"},on:{onConfirm:function(a){return t.handleDelete(e.id)}},scopedSlots:t._u([{key:"reference",fn:function(){return[a("svg-icon",{attrs:{name:"DeleteOutlined"}})]},proxy:!0}],null,!0)})],1)],1)])],1)])})),0)]),a("div",{staticClass:"attachment-pagination"},[a("pagination",t._b({on:{pagination:t.handlePagination}},"pagination",t.pagination,!1))],1),a("el-drawer",{attrs:{visible:t.drawer,size:"380",direction:"rtl","wrapper-closable":!0,"append-to-body":!1,"show-close":!0},on:{close:t.handleDrawerClose},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[t._v("上传附件")])]},proxy:!0}])},[a("div",{staticClass:"drawer-content"},[a("div",{staticClass:"attachment-upload"},[a("el-upload",{ref:"upload",attrs:{action:"",drag:"",multiple:"",limit:t.limit,"auto-upload":!1,"http-request":t.upload,"on-exceed":t.handleExceed,"on-preview":t.handlePreview,"on-change":t.handleChange,"list-type":"picture"},scopedSlots:t._u([{key:"tip",fn:function(){return[a("div",{staticClass:"el-upload__tip"},[t._v(" 单个文件限制 500MB，最多同时上传 10 个文件, 但总大小不得超过 2GB ")])]},proxy:!0}])},[a("svg-icon",{staticClass:"upload-icon",attrs:{name:"cloudUpload"}}),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或点击选取文件")])],1)],1)]),a("div",{staticClass:"drawer-footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.buttonLoading},on:{click:t.submitUpload}},[t._v(" "+t._s(t.buttonLoading?"上传中 ...":"上 传")+" ")]),a("el-button",{attrs:{type:"danger",size:"small"},on:{click:t.clearFiles}},[t._v("清 空")])],1)])],1)},i=[],o=(a("99af"),a("4160"),a("b0c0"),a("159b"),a("f3f3")),c=(a("a4d3"),a("e01a"),a("a15b"),a("b64b"),a("b775")),r="/admin",s={imgSrcBaseUrl:"/files",getAttachment:function(t){return Object(c["a"])({url:"".concat(r,"/attachments/").concat(t),method:"get"})},getAttachmentPage:function(t){var e=t.name,a=t.originalName,n=t.type,i=t.description,o=t.page,s=t.size;return Object(c["a"])({url:"".concat(r,"/attachments"),method:"get",params:{name:e,originalName:a,type:n,description:i,page:o,size:s}})},uploadAttachment:function(t,e){var a=new FormData;return e&&Object.keys(e).forEach((function(t){e[t]&&a.append(t,e[t])})),a.append(t.filename,t.file,t.file.name),Object(c["a"])({url:"".concat(r,"/attachments"),method:"post",data:a,onUploadProgress:function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.onProgress(e)}})},uploadAttachmentBatch:function(t){var e=new FormData;return t.forEach((function(t,a){e.append("file".concat(a),t.file,t.file.name)})),Object(c["a"])({url:"".concat(r,"/attachment/batch"),method:"post",data:e,onUploadProgress:function(e){e.total>0&&(e.percent=e.loaded/e.total*100),t.forEach((function(t){t.onProgress(e)}))}})},deleteAttachment:function(t){return Object(c["a"])({url:"".concat(r,"/attachments/").concat(t),method:"delete"})},deleteAttachmentBatch:function(t){return Object(c["a"])({url:"".concat(r,"/attachments/").concat(t.join(","),"/batch"),method:"delete"})},updateAttachment:function(t){var e=t.id,a=t.originalName,n=t.description,i=t.height,o=t.width;return Object(c["a"])({url:"".concat(r,"/attachments/").concat(e),method:"put",data:{id:e,originalName:a,description:n,height:i,width:o}})}},l=s,u={name:"Attachment",data:function(){return{imgSrcBaseUrl:l.imgSrcBaseUrl,uploadList:[],limit:10,attachmentList:[],attachmentPreviewList:[],queryParam:{name:"",originalName:"",type:"",description:""},pagination:{page:1,size:20,total:0},drawer:!1,buttonLoading:!1,loading:!1}},methods:{getAttachmentPage:function(){var t=this;this.loading=!0,l.getAttachmentPage(Object(o["a"])(Object(o["a"])({},this.queryParam),this.pagination)).then((function(e){var a=e.data;t.attachmentList=a.records,t.pagination.page=a.current,t.pagination.size=a.size,t.pagination.total=a.total})).catch((function(){})).then((function(){t.loading=!1}))},handlePagination:function(t){this.pagination.page=t.page,this.pagination.size=t.size,this.getAttachmentPage()},submitUpload:function(){var t=this;this.$refs.upload.submit(),0!==this.uploadList.length?(this.buttonLoading=!0,l.uploadAttachmentBatch(this.uploadList).then((function(e){t.$message.success("上传成功"),t.uploadList.forEach((function(t){return t.onSuccess(e)}))})).catch((function(e){t.$message.error("上传失败"),t.uploadList.forEach((function(t){return t.onError(e)}))})).then((function(){t.buttonLoading=!1,t.uploadList=[]}))):this.$message.info("没有需要上传的文件")},upload:function(t){this.uploadList.push(t)},handleExceed:function(){this.$message.error("添加失败, 超出上传文件数量限制. ")},handlePreview:function(t){t.status,console.dir(t)},handleChange:function(t,e){"ready"===t.status&&e.unshift(e.pop())},clearFiles:function(){this.$refs.upload.clearFiles()},handlePreviewList:function(t){this.attachmentPreviewList=[];for(var e=0;e<this.attachmentList.length;e++){var a=e+t;a>=this.attachmentList.length&&(a-=this.attachmentList.length);var n="".concat(this.imgSrcBaseUrl,"/").concat(this.attachmentList[e].name);this.attachmentPreviewList.push(n)}this.$refs["image-".concat(t)][0].clickHandler()},handleDownload:function(t){window.location.href="".concat(this.imgSrcBaseUrl,"/").concat(t)},handleDelete:function(t){var e=this;l.deleteAttachment(t).then((function(){e.$message.success("删除成功"),e.getAttachmentPage()})).catch((function(){e.$message.error("删除失败")})).then((function(){}))},handleCopyUrl:function(t){var e=this;this.$copyText("".concat(this.imgSrcBaseUrl,"/").concat(t)).then((function(){e.$message.success("复制成功: ".concat(e.imgSrcBaseUrl,"/").concat(t))})).catch((function(){e.$message.success("复制失败")}))},handleDrawerClose:function(){this.drawer=!1},handleFilter:function(){}},created:function(){this.getAttachmentPage()}},d=u,m=(a("137f"),a("2877")),h=Object(m["a"])(d,n,i,!1,null,null,null);e["default"]=h.exports}}]);