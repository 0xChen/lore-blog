<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org" th:with="title='添加/维护链接',active='links'">
<!--/*@thymesVar id="#blog" type="com.developerchen.blog.theme.Common"*/-->
<head>
    <th:block th:replace="admin/header::header(${title})"></th:block>
    <link href="//cdn.staticfile.org/bootstrap-toggle/2.2.2/css/bootstrap-toggle.css" rel="stylesheet">
</head>
<body class="fixed-left">
<div id="wrapper">
    <!-- sidebar -->
    <th:block th:replace="admin/sidebar::sidebar(${active},'')"></th:block>
    <div class="content-page">
        <div class="content">
            <div class="container">
                <div id="app" class="row" v-cloak>
                    <loading :active.sync="isLoading" :can-cancel="true"></loading>
                    <div class="col-lg-12">
                        <div class="panel panel-primary">
                            <div class="panel-heading">
                                <h3 class="panel-title">{{ link.id ?  '编辑链接' : '新增链接'}}</h3>
                            </div>
                            <div class="panel-body">
                                <form id="linkForm" class="form-horizontal">
                                    <div class="form-group col-md-12">
                                        <label class="col-sm-1 control-label">名称</label>
                                        <div class="col-sm-11">
                                            <input class="form-control" type="text" v-model="link.name" placeholder="请输入链接名称" required>
                                        </div>
                                    </div>

                                    <div class="form-group col-md-12">
                                        <label class="col-sm-1 control-label">URL</label>
                                        <div class="col-sm-11">
                                            <input class="form-control" id="url" type="text"  v-model="link.url" >
                                        </div>
                                    </div>

                                    <div class="form-group col-md-6 col-xs-12">
                                        <label class="col-sm-2 control-label">排序</label>
                                        <div class="col-sm-4">
                                            <input class="form-control" id="sort" type="text"  v-model="link.sort" placeholder="数字">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-pull-3 col-md-6 col-xs-12">
                                        <label class="col-sm-3 control-label">是否显示</label>
                                        <div class="col-sm-3">
                                            <input type="checkbox" id="visible"
                                                   v-model="link.visible"
                                                   true-value="1"
                                                   false-value="0">
                                        </div>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <label class="col-sm-1 control-label">描述</label>
                                        <div class="col-sm-11">
                                            <textarea class="form-control" rows="3" id="description" name="description" v-model="link.description"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-12">
                                        <a class="btn btn-default waves-effect waves-light col-md-offset-10 col-xs-offset-9" href="/admin/links">返回列表</a>
                                        <button type="button" class="btn btn-warning waves-effect waves-light" @click="saveOrUpdate()">
                                            保存
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div th:replace="admin/footer :: footer"></div>
<script src="//cdn.staticfile.org/bootstrap-toggle/2.2.2/js/bootstrap-toggle.js"></script>
<script >
    var blog = new $.Blog();
    var vm = new Vue({
        el: '#app',
        data: {
            link: {},
            isLoading: true,
        },
        beforeCreate: function () {
            vueLoding = this.$loading.show();
        },
        mounted: function () {
            this.load();
        },
        methods: {
            load: function () {
                var $vm = this;
                var pos = window.location.toString().lastIndexOf("/");
                var linkId = window.location.toString().substring(pos + 1);

                if (linkId.length) {
                    blog.get({
                        url: '/admin/api/link/' + linkId,
                        success: function (result) {
                            $vm.link = result.data
                        },
                        error: function (error) {
                            console.log(error);
                            alert(error || '数据加载失败');
                        }
                    });
                }
            },
            saveOrUpdate: function () {
                var $vm = this;
                var link = blog.copy($vm.link);

                blog.post({
                    url: '/admin/api/link',
                    data: link,
                    success: function (result) {
                        if (result && result.success) {
                            $vm.link.id = result.data.id;
                            blog.alertOk('保存成功');
                        } else {
                            blog.alertError(result.message || '保存失败');
                        }
                    },
                    error: function (error) {
                        console.log(error);
                        blog.alertError('保存失败');
                    }
                });

            }
        }
    });

    $(function () {
        $('#visible').bootstrapToggle({
            on: '是',
            off: '否'
        });
        $('#visible').change(function() {
            var checked = $(this).prop('checked');
            if (checked) {
                vm.link.visible = '1';
            } else {
                vm.link.visible = '0';
            }
        });
        vm.isLoading = false;
        vueLoding.hide();
    });
</script>

</body>
</html>